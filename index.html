<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Assignment 1</title>
    <link rel="stylesheet" href="leaflet/leaflet.css"/>
    <link rel="stylesheet" href="css/1.css"/>
    <!--Load the jquery-->
    <script src="js/jquery.min.js"></script>
    <style>
        .info {
            padding: 6px 8px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        .info h4 {
            margin: 0 0 5px;
            color: #777;
        }
    </style>
</head>

<body>
<div id="map"></div>
<!--Load Leaflet after defining the  div with id of map-->
<script src="leaflet/leaflet.js"></script>

<!--Lets load all the data necessary TODO  can consider adding a spinner while the data is loading-->
<script src='data/bus_routes.js' ></script>
<!--Lets do the scripting-->
<script>
    // Set the map
    var map = L.map('map', { zoomControl:true }).fitBounds([[1.0767513637,103.591111131],[1.57579761917,104.103108808]]);
    // group for the  vectors
    var feature_group = new L.featureGroup([]);

    var osmStandardBaseMap = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
    var osmBlackAndWhiteBaseMap = L.tileLayer('http://{s}.www.toolserver.org/tiles/bw-mapnik/{z}/{x}/{y}.png');

    // Add the base layers to the map
    osmStandardBaseMap.addTo(map);
    osmBlackAndWhiteBaseMap.addTo(map);
    // baseMaps key value pair to be added in the layer group
    var baseMaps = {
        'OSM Standard' : osmStandardBaseMap,
        'OSM Black & White' : osmBlackAndWhiteBaseMap
    };

    // General Information container control
    var info = L.control();
    info.onAdd = function (map) {
        this._div = L.DomUtil.create('div', 'info');
        this.update();
        return this._div;
    };

    info.update = function (htmlContent) {
        this._div.innerHTML = htmlContent ?  htmlContent : '<h4> Connectivity Analysis </h4>' +
        ' Hover over the features to see details';
    };

    info.addTo(map);



    // Lets deal with the basic layers first

    /**
     * Reset the highlight the feature of  busroute
     * @param e
     */
    function highlightFeatureBusRoute(e){
        var layer = e.target;

        layer.setStyle({
            weight: 2,
            color: 'white',
            dashArray: '',
            fillOpacity: 0.7
        });

        if (!L.Browser.ie && !L.Browser.opera) {
            layer.bringToFront();
        }
        info.update('<h4>Bus Routes</h4>' +
        ' Service Number:' + layer.feature.properties.svc_num+' <br/>' +
        ' Service Direction: ' + layer.feature.properties.svc_dir);
    }

    var busRoutesGeoJson ;
    /**
     * Reset the style of the BusRoute
     * @param e
     */
    function resetHighlightBusRoute(e){
        busRoutesGeoJson.resetStyle(e.target);
        info.update();
    }

    function onEachFeatureBusRoute(feature, layer) {
        layer.on({
            mouseover: highlightFeatureBusRoute,
            mouseout: resetHighlightBusRoute
            //click: zoomToFeature
        });
    }
    // Define the bus route layer
    busRoutesGeoJson  = L.geoJson(busRouteData,{
        style:styleBusRoute,
        onEachFeature:onEachFeatureBusRoute
    });
    busRoutesGeoJson.addTo(map);

    function styleBusRoute(feature) {
        return {
            opacity: 1,
            weight:1,
            color: '#666'
        };
    }
    // Pop up function for the bus route
    function popUpBusRoute(feature, layer){

    }





</script>

</body>
</html>