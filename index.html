<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Assignment 1</title>
    <link rel="stylesheet" href="leaflet/leaflet.css"/>


    <link rel="stylesheet" href="css/main.css"/>
    <!--Load the jquery-->
    <script src="js/jquery.min.js"></script>
    <style>
        .info {
            padding: 6px 8px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        .info h4 {
            margin: 0 0 5px;
            color: #777;
        }
    </style>

    <!-- CSS for Plugins-->
    <!--Font awesome-->
    <link href="plugins/locate/font-awesome.min.css" rel="stylesheet">
    <!--Locate -->
    <link rel="stylesheet" href="plugins/locate/L.Control.Locate.min.css" />
    <!--[if lt IE 9]>
    <link rel="stylesheet" href="plugins/locate/L.Control.Locate.ie.min.css"/>
    <![endif]-->
    <!--Geo Search-->
    <link rel="stylesheet" href="plugins/geosearch/l.geosearch.css"/>

</head>

<body>
<div id="map"></div>
<!--Load Leaflet after defining the  div with id of map-->
<script src="leaflet/leaflet.js"></script>
<!--Load any js files for plugins-->
<!--Locate-->
<script src="plugins/locate/L.Control.Locate.min.js" ></script>
<script src="plugins/geosearch/l.control.geosearch.js" ></script>
<script src="plugins/geosearch/l.geosearch.provider.openstreetmap.js" ></script>



<!--Lets load all the data necessary TODO  can consider adding a spinner while the data is loading-->
<script src='data/bus_routes.js' ></script>
<!--Lets do the scripting-->
<script>
    // Set the map
    var map = L.map('map', { zoomControl:true }).fitBounds([[1.0767513637,103.591111131],[1.57579761917,104.103108808]]);
    // group for the  vectors
    var feature_group = new L.featureGroup([]);

    var osmStandardBaseMap = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
    var osmBlackAndWhiteBaseMap = L.tileLayer('http://{s}.www.toolserver.org/tiles/bw-mapnik/{z}/{x}/{y}.png');

    // Add the base layers to the map
    osmStandardBaseMap.addTo(map);
    osmBlackAndWhiteBaseMap.addTo(map);
    // baseMaps key value pair to be added in the layer group
    var baseMaps = {
        'OSM Standard' : osmStandardBaseMap,
        'OSM Black & White' : osmBlackAndWhiteBaseMap
    };

    // General Information container control
    var info = L.control({position:'topright'});
    info.onAdd = function (map) {
        this._div = L.DomUtil.create('div', 'info');
        this.update();
        return this._div;
    };

    info.update = function (htmlContent) {
        this._div.innerHTML = htmlContent ?  htmlContent : '<h4> Information Panel</h4> Hover over  the features to see details' ;

    };

    info.addTo(map);



    // Lets deal with the basic layers first

    /**
     * Reset the highlight the feature of  busroute
     * @param e
     */
    function highlightFeatureBusRoute(e){
        var layer = e.target;

        layer.setStyle({
            weight: 2,
            color: 'white',
            dashArray: '',
            fillOpacity: 0.7
        });

        if (!L.Browser.ie && !L.Browser.opera) {
            layer.bringToFront();
        }
        info.update('<h4>Bus Routes</h4>' +
        ' Service Number:' + layer.feature.properties.svc_num+' <br/>' +
        ' Service Direction: ' + layer.feature.properties.svc_dir);
    }

    var busRoutesGeoJson ;
    /**
     * Reset the style of the BusRoute
     * @param e
     */
    function resetHighlightBusRoute(e){
        busRoutesGeoJson.resetStyle(e.target);
        info.update();
    }

    function onEachFeatureBusRoute(feature, layer) {
        layer.on({
            mouseover: highlightFeatureBusRoute,
            mouseout: resetHighlightBusRoute
            //click: zoomToFeature
        });
    }
    // Define the bus route layer
    busRoutesGeoJson  = L.geoJson(busRouteData,{
        style:styleBusRoute,
        onEachFeature:onEachFeatureBusRoute
    });


    busRoutesGeoJson.addTo(map);

    function styleBusRoute(feature) {
        return {
            opacity: 1,
            weight:1,
            color: '#666'
        };
    }

    // Add the layer controls
    L.control.layers(baseMaps,{'Bus Routes': busRoutesGeoJson},{collapsed:true}).addTo(map);




    // Additional Plugins

    // domoritz/leaflet-locatecontrol
    L.control.locate({
        position: 'topleft',  // set the location of the control
        drawCircle: true,  // controls whether a circle is drawn that shows the uncertainty about the location
        follow: false,  // follow the user's location
        setView: true, // automatically sets the map view to the user's location, enabled if `follow` is true
        stopFollowingOnDrag: false, // stop following when the map is dragged if `follow` is true (deprecated, see below)
        circleStyle: {},  // change the style of the circle around the user's location
        markerStyle: {},
        followCircleStyle: {},  // set difference for the style of the circle around the user's location while following
        followMarkerStyle: {},
        circlePadding: [0, 0], // padding around accuracy circle, value is passed to setBounds
        metric: true,  // use metric or imperial units
        onLocationError: function(err) {alert(err.message)},  // define an error callback function
        onLocationOutsideMapBounds:  function(context) { // called when outside map boundaries
            alert(context.options.strings.outsideMapBoundsMsg);
        },
        strings: {
            title: "Show me where I am",  // title of the locat control
            popup: "You are within {distance} {unit} from this point",  // text to appear if user clicks on circle
            outsideMapBoundsMsg: "You seem located outside the boundaries of the map" // default message for onLocationOutsideMapBounds
        },
        locateOptions: {}  // define location options e.g enableHighAccuracy: true
    }).addTo(map);



    new L.Control.GeoSearch({
        provider: new L.GeoSearch.Provider.OpenStreetMap(),
        position: 'topcenter',
        showMarker: true
    }).addTo(map);


</script>

</body>
</html>